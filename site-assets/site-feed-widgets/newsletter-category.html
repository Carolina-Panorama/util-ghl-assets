<script>
// Select/Deselect All functionality for newsletter category checkboxes
function initCategorySelectAll() {
  const container = document.querySelector('.form-builder--item .flex-col div');
  if (!container) {
    console.warn('[CategoryWidget] Container not found');
    return;
  }

  // Find the Select/Deselect All checkbox by its label text
  let selectAllCheckbox = null;
  const allCheckboxes = container.querySelectorAll('input[type="checkbox"][data-q="section-selection"]');
  
  for (const cb of allCheckboxes) {
    const label = cb.closest('label');
    if (label && label.textContent.includes('Select/Unselect All')) {
      selectAllCheckbox = cb;
      break;
    }
  }

  if (!selectAllCheckbox) {
    console.warn('[CategoryWidget] Select/Unselect All checkbox not found');
    return;
  }

  // Get all category checkboxes (excluding the select all)
  const checkboxes = Array.from(allCheckboxes).filter(cb => cb !== selectAllCheckbox);
  
  if (checkboxes.length === 0) {
    console.warn('[CategoryWidget] No category checkboxes found');
    return;
  }

  // Handle select all toggle
  selectAllCheckbox.addEventListener('change', function() {
    checkboxes.forEach(cb => {
      cb.checked = selectAllCheckbox.checked;
      cb.dispatchEvent(new Event('change', { bubbles: true }));
    });
  });

  // Update select all state when individual checkboxes change
  checkboxes.forEach(cb => {
    cb.addEventListener('change', function() {
      const allChecked = checkboxes.every(c => c.checked);
      const noneChecked = checkboxes.every(c => !c.checked);
      
      if (allChecked) {
        selectAllCheckbox.checked = true;
        selectAllCheckbox.indeterminate = false;
      } else if (noneChecked) {
        selectAllCheckbox.checked = false;
        selectAllCheckbox.indeterminate = false;
      } else {
        selectAllCheckbox.indeterminate = true;
      }
    });
  });

  console.log('[CategoryWidget] Select all initialized with', checkboxes.length, 'category checkboxes');
}

initCategorySelectAll();
</script>
