<!-- Headlines Grid Widget - Displays 5 articles with featured layout -->
<!-- Include shared-article-card-styles.css in your page -->

<style>
    .headlines-section-wrapper {
        width: 100%;
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
    }

    .headlines-section-header {
        text-align: center;
        margin-bottom: 32px;
        padding-bottom: 16px;
        border-bottom: 3px solid #3b82f6;
    }

    .headlines-section-title {
        font-size: 2.5rem;
        font-weight: 700;
        color: #1a1a1a;
        margin: 0;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-family: 'Georgia', serif;
    }

    .headlines-grid {
        display: grid;
        grid-template-columns: 1fr 2fr 1fr;
        grid-template-rows: 1fr 1fr;
        gap: 20px;
    }

    /* Featured badge for center article */
    .featured-badge {
        position: absolute;
        top: 12px;
        left: 12px;
        background: #dc2626;
        color: white;
        padding: 6px 14px;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        z-index: 10;
        box-shadow: 0 2px 8px rgba(220, 38, 38, 0.3);
    }

    /* Grid positioning */
    .headlines-center {
        grid-column: 2;
        grid-row: 1 / 3;
        position: relative;
    }

    .headlines-left-top {
        grid-column: 1;
        grid-row: 1;
    }

    .headlines-left-bottom {
        grid-column: 1;
        grid-row: 2;
    }

    .headlines-right-top {
        grid-column: 3;
        grid-row: 1;
    }

    .headlines-right-bottom {
        grid-column: 3;
        grid-row: 2;
    }

    /* Responsive design */
    @media (max-width: 1024px) {
        .headlines-grid {
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto;
        }

        .headlines-center {
            grid-column: 1 / 3;
            grid-row: 1;
        }

        .headlines-left-top {
            grid-column: 1;
            grid-row: 2;
        }

        .headlines-left-bottom {
            grid-column: 2;
            grid-row: 2;
        }

        .headlines-right-top {
            grid-column: 1;
            grid-row: 3;
        }

        .headlines-right-bottom {
            grid-column: 2;
            grid-row: 3;
        }
    }

    @media (max-width: 640px) {
        .headlines-section-header {
            margin-bottom: 16px;
        }

        .headlines-section-title {
            font-size: 1.5rem;
        }

        .headlines-grid {
            grid-template-columns: 1fr;
            gap: 16px;
        }

        .headlines-center,
        .headlines-left-top,
        .headlines-left-bottom,
        .headlines-right-top,
        .headlines-right-bottom {
            grid-column: 1;
            grid-row: auto;
        }
    }
</style>

<div class="headlines-section-wrapper">
    <div class="headlines-section-header">
        <h2 class="headlines-section-title">Top Headlines</h2>
    </div>

    <div class="headlines-grid">
        <!-- Featured article (center) - index 0 -->
        <div class="headlines-center">
            <span class="featured-badge">Featured</span>
            <article class="cp-article-card cp-article-card-featured">
                <a href="#" class="cp-article-card-link" data-article-index="0">
                    <img src="https://via.placeholder.com/800x300" alt="Article" class="cp-article-image" fetchpriority="high" loading="eager">
                    <div class="cp-article-content">
                        <div class="cp-article-tags">
                            <span class="cp-article-tag">Loading</span>
                        </div>
                        <h2 class="cp-article-title">Loading article...</h2>
                        <div class="cp-article-meta">
                            <span class="cp-article-author">Carolina Panorama</span>
                            <span class="cp-article-date">Today</span>
                        </div>
                        <p class="cp-article-description">Please wait while we load the content...</p>
                    </div>
                </a>
            </article>
        </div>

        <!-- Side articles - indices 1-4 -->
        <div class="headlines-left-top">
            <article class="cp-article-card cp-article-card-small">
                <a href="#" class="cp-article-card-link" data-article-index="1">
                    <img src="https://via.placeholder.com/400x150" alt="Article" class="cp-article-image" fetchpriority="high" loading="eager">
                    <div class="cp-article-content">
                        <div class="cp-article-tags">
                            <span class="cp-article-tag">Loading</span>
                        </div>
                        <h3 class="cp-article-title">Loading...</h3>
                        <div class="cp-article-meta">
                            <span class="cp-article-date">Today</span>
                        </div>
                    </div>
                </a>
            </article>
        </div>

        <div class="headlines-left-bottom">
            <article class="cp-article-card cp-article-card-small">
                <a href="#" class="cp-article-card-link" data-article-index="2">
                    <img src="https://via.placeholder.com/400x150" alt="Article" class="cp-article-image" fetchpriority="high" loading="eager">
                    <div class="cp-article-content">
                        <div class="cp-article-tags">
                            <span class="cp-article-tag">Loading</span>
                        </div>
                        <h3 class="cp-article-title">Loading...</h3>
                        <div class="cp-article-meta">
                            <span class="cp-article-date">Today</span>
                        </div>
                    </div>
                </a>
            </article>
        </div>

        <div class="headlines-right-top">
            <article class="cp-article-card cp-article-card-small">
                <a href="#" class="cp-article-card-link" data-article-index="3">
                    <img src="https://via.placeholder.com/400x150" alt="Article" class="cp-article-image" fetchpriority="high" loading="eager">
                    <div class="cp-article-content">
                        <div class="cp-article-tags">
                            <span class="cp-article-tag">Loading</span>
                        </div>
                        <h3 class="cp-article-title">Loading...</h3>
                        <div class="cp-article-meta">
                            <span class="cp-article-date">Today</span>
                        </div>
                    </div>
                </a>
            </article>
        </div>

        <div class="headlines-right-bottom">
            <article class="cp-article-card cp-article-card-small">
                <a href="#" class="cp-article-card-link" data-article-index="4">
                    <img src="https://via.placeholder.com/400x150" alt="Article" class="cp-article-image" fetchpriority="high" loading="eager">
                    <div class="cp-article-content">
                        <div class="cp-article-tags">
                            <span class="cp-article-tag">Loading</span>
                        </div>
                        <h3 class="cp-article-title">Loading...</h3>
                        <div class="cp-article-meta">
                            <span class="cp-article-date">Today</span>
                        </div>
                    </div>
                </a>
            </article>
        </div>
    </div>
</div>

    <!-- GHL-provided top articles key (comma-separated list). Replace via GHL template: {{custom_values.top_articles}} -->
    <script id="GHL_TOP_ARTICLES" type="text/plain">{{custom_values.top_articles}}</script>

    <script>
        (function() {
            // Read GHL custom value (comma-separated list) and populate window.TOP_ARTICLES
            (function readGHLTopArticles() {
                try {
                    const el = document.getElementById('GHL_TOP_ARTICLES');
                    if (!el) return;
                    const raw = (el.textContent || '').trim();
                    if (!raw) return;

                    // Expecting comma-separated list like: id1,id2,id3
                    const items = raw.split(/,|\r?\n/).map(s => s.trim()).filter(Boolean);
                    if (items.length) {
                        window.TOP_ARTICLES = items;
                    }
                } catch (e) {
                    console.error('Error reading GHL_TOP_ARTICLES:', e);
                }
            })();

            // Wait for TOP_ARTICLES to be available
            function waitForArticles(callback, timeout = 5000) {
                const startTime = Date.now();
                const checkInterval = setInterval(() => {
                    if (window.TOP_ARTICLES && window.TOP_ARTICLES.length >= 5) {
                        clearInterval(checkInterval);
                        callback();
                    } else if (Date.now() - startTime > timeout) {
                        clearInterval(checkInterval);
                        console.error('TOP_ARTICLES not found or has fewer than 5 articles');
                    }
                }, 50);
            }

        // Fetch metadata for a single article
        async function fetchArticleMetadata(url) {
            try {
                const response = await fetch(url);
                const html = await response.text();
                
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                
                const getMetaContent = (property) => {
                    const ogTag = doc.querySelector(`meta[property="${property}"]`);
                    const nameTag = doc.querySelector(`meta[name="${property}"]`);
                    return ogTag?.content || nameTag?.content || '';
                };
                
                // Extract metadata
                const title = getMetaContent('og:title') || 
                             getMetaContent('twitter:title') || 
                             doc.querySelector('title')?.textContent || 
                             'Article';
                
                const description = getMetaContent('og:description') || 
                                   getMetaContent('twitter:description') || 
                                   getMetaContent('description') || 
                                   '';
                
                const image = getMetaContent('og:image') || 
                             getMetaContent('twitter:image') || 
                             'https://via.placeholder.com/400x200';
                
                // Extract author
                const authorElement = doc.querySelector('.blog-author-name, [itemprop="author"]');
                const author = authorElement?.textContent?.trim() || 'Carolina Panorama';
                
                // Extract date - prioritize article:published_time meta tag
                let dateStr = doc.querySelector('meta[property="article:published_time"]')?.getAttribute('content');
                if (!dateStr) {
                    const dateElement = doc.querySelector('[itemprop="datePublished"], time');
                    dateStr = dateElement?.getAttribute('datetime') || dateElement?.textContent;
                }
                const date = dateStr ? new Date(dateStr) : new Date();
                
                // Extract categories/tags
                const categoryElements = doc.querySelectorAll('.blog-category, [rel="category tag"]');
                const categories = Array.from(categoryElements)
                    .map(el => el.textContent.trim().replace(/^\|\s*/, '')) // Remove leading pipe
                    .filter(Boolean);
                
                return {
                    url: url,
                    title: title,
                    description: description,
                    image: image,
                    author: author,
                    date: date,
                    categories: categories.length > 0 ? categories : ['News']
                };
            } catch (error) {
                console.error('Error fetching article metadata:', error);
                return {
                    url: url,
                    title: 'Unable to load article',
                    description: '',
                    image: 'https://via.placeholder.com/400x200',
                    author: 'Carolina Panorama',
                    date: new Date(),
                    categories: ['News']
                };
            }
        }

        // Format date as "Month DD, YYYY"
        function formatDate(date) {
            const options = { month: 'short', day: 'numeric', year: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }

        // Update a single article card
        function updateArticleCard(linkElement, data) {
            linkElement.href = data.url;
            
            const image = linkElement.querySelector('.cp-article-image');
            image.src = data.image;
            image.alt = data.title;
            
            const tagsContainer = linkElement.querySelector('.cp-article-tags');
            tagsContainer.innerHTML = data.categories.slice(0, 2).map(cat => 
                `<span class="cp-article-tag ${cat.toLowerCase()}">${cat}</span>`
            ).join('');
            
            const title = linkElement.querySelector('.cp-article-title');
            title.textContent = data.title;
            
            const meta = linkElement.querySelector('.cp-article-meta');
            const authorSpan = meta.querySelector('.cp-article-author');
            if (authorSpan) {
                authorSpan.textContent = data.author;
            }
            const dateSpan = meta.querySelector('.cp-article-date');
            dateSpan.textContent = formatDate(data.date);
            
            const description = linkElement.querySelector('.cp-article-description');
            if (description && data.description) {
                description.textContent = data.description;
            }
        }

        // Initialize all articles
        async function initializeGrid() {
            const articleLinks = document.querySelectorAll('.cp-article-card-link');
            
            const promises = Array.from(articleLinks).map(async (link) => {
                const index = parseInt(link.getAttribute('data-article-index'), 10);
                const articleId = window.TOP_ARTICLES[index];
                
                if (articleId) {
                    const articleUrl = `/post/${articleId}`;
                    const data = await fetchArticleMetadata(articleUrl);
                    updateArticleCard(link, data);
                }
            });
            
            await Promise.all(promises);
        }

        // Wait for articles and then initialize
        waitForArticles(() => {
            initializeGrid();
        });
    })();
</script>
